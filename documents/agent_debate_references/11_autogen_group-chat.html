
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Group Chat &#8212; AutoGen</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=069332a8" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=ea3bebfc"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "lnxpe6skj1");</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/core-user-guide/design-patterns/group-chat';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.0';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/microsoft/autogen/refs/heads/main/docs/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'stable';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = true;
        </script>
    <script src="../../../_static/custom-icon.js?v=a32026ea"></script>
    <script src="../../../_static/banner-override.js?v=8cd4f749"></script>
    <script src="../../../_static/custom.js?v=70c1e88a"></script>
    <link rel="canonical" href="/autogen/stable//user-guide/core-user-guide/design-patterns/group-chat.html" />
    <link rel="icon" href="../../../_static/favicon-512x512.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Handoffs" href="handoffs.html" />
    <link rel="prev" title="Sequential Workflow" href="sequential-workflow.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.4" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.svg" class="logo__image only-light" alt="AutoGen - Home"/>
    <img src="../../../_static/logo.svg" class="logo__image only-dark pst-js-only" alt="AutoGen - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../agentchat-user-guide/index.html">
    AgentChat
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Core
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../extensions-user-guide/index.html">
    Extensions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../autogenstudio-user-guide/index.html">
    Studio
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://microsoft.github.io/autogen/dotnet/">
    .NET
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://microsoft.github.io/autogen/0.2/">
    0.2 Docs
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/microsoft/autogen" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://aka.ms/autogen-discord" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pyautogen" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../agentchat-user-guide/index.html">
    AgentChat
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Core
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../extensions-user-guide/index.html">
    Extensions
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../autogenstudio-user-guide/index.html">
    Studio
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://microsoft.github.io/autogen/dotnet/">
    .NET
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://microsoft.github.io/autogen/0.2/">
    0.2 Docs
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/microsoft/autogen" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://aka.ms/autogen-discord" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pyautogen" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

<nav class="bd-docs-nav bd-links" aria-label="Section Navigation">
    <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../core-concepts/agent-and-multi-agent-application.html">Agent and Multi-Agent Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-concepts/architecture.html">Agent Runtime Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-concepts/application-stack.html">Application Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-concepts/agent-identity-and-lifecycle.html">Agent Identity and Lifecycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-concepts/topic-and-subscription.html">Topic and Subscription</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Framework Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../framework/agent-and-agent-runtime.html">Agent and Agent Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework/message-and-communication.html">Message and Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework/telemetry.html">Open Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework/distributed-agent-runtime.html">Distributed Agent Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework/component-config.html">Component config</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Components Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../components/model-clients.html">Model Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/model-context.html">Model Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/workbench.html">Workbench (and MCP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/command-line-code-executors.html">Command Line Code Executors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Multi-Agent Design Patterns</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrent-agents.html">Concurrent Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="sequential-workflow.html">Sequential Workflow</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Group Chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="handoffs.html">Handoffs</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixture-of-agents.html">Mixture of Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi-agent-debate.html">Multi-Agent Debate</a></li>
<li class="toctree-l1"><a class="reference internal" href="reflection.html">Reflection</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-execution-groupchat.html">Code Execution</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">More</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../cookbook/index.html">Cookbook</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/azure-openai-with-aad-auth.html">Azure OpenAI with AAD Auth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/termination-with-intervention.html">Termination using Intervention Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/tool-use-with-intervention.html">User Approval for Tool Execution using Intervention Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/extracting-results-with-an-agent.html">Extracting Results with an Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/openai-assistant-agent.html">OpenAI Assistant Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/langgraph-agent.html">Using LangGraph-Backed Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/llamaindex-agent.html">Using LlamaIndex-Backed Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/local-llms-ollama-litellm.html">Local LLMs with LiteLLM &amp; Ollama</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/instrumenting.html">Instrumentating your code locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/topic-subscription-scenarios.html">Topic and Subscription Example Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/structured-output-agent.html">Structured output using GPT-4o models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/llm-usage-logger.html">Tracking LLM usage with a logger</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">FAQs</a></li>
</ul>
<ul class="nav bd-sidenav">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../reference/python/autogen_core.html">
                    <i class="fa-solid fa-file-code"></i>
                    API Reference
                </a>
            </li>
            <li class="toctree-l1">
                <a target="_blank" class="reference internal" href="https://pypi.org/project/autogen-core/">
                    <i class="fa-brands fa-python"></i>
                    PyPi
                    <i class="fa-solid fa-arrow-up-right-from-square fa-2xs"></i>
                </a>
            </li>
            <li class="toctree-l1">
                <a target="_blank" class="reference internal"
                    href="https://github.com/microsoft/autogen/tree/main/python/packages/autogen-core">
                    <i class="fa-brands fa-github"></i>
                    Source
                    <i class="fa-solid fa-arrow-up-right-from-square fa-2xs"></i>
                </a>
            </li>
        </ul>
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Core</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Group Chat</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="group-chat">
<h1>Group Chat<a class="headerlink" href="#group-chat" title="Link to this heading">#</a></h1>
<p>Group chat is a design pattern where a group of agents share a common thread
of messages: they all subscribe and publish to the same topic.
Each participant agent is specialized for a particular task,
such as writer, illustrator, and editor
in a collaborative writing task.
You can also include an agent to represent a human user to help guide the
agents when needed.</p>
<p>In a group chat, participants take turn to publish a message, and the process
is sequential – only one agent is working at a time.
Under the hood, the order of turns is maintained by a Group Chat Manager agent,
which selects the next agent to speak upon receiving a message.
The exact algorithm for selecting the next agent can vary based on your
application requirements.
Typically, a round-robin algorithm or a selector with an LLM model is used.</p>
<p>Group chat is useful for dynamically decomposing a complex task into smaller ones
that can be handled by specialized agents with well-defined roles.
It is also possible to nest group chats into a hierarchy with each participant
a recursive group chat.</p>
<p>In this example, we use AutoGen’s Core API to implement the group chat pattern
using event-driven agents.
Please first read about <a class="reference internal" href="../core-concepts/topic-and-subscription.html"><span class="std std-doc">Topics and Subscriptions</span></a>
to understand the concepts and then <a class="reference internal" href="../framework/message-and-communication.html"><span class="std std-doc">Messages and Communication</span></a>
to learn the API usage for pub-sub.
We will demonstrate a simple example of a group chat with a LLM-based selector
for the group chat manager, to create content for a children’s story book.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While this example illustrates the group chat mechanism, it is complex and
represents a starting point from which you can build your own group chat system
with custom agents and speaker selection algorithms.
The <a class="reference internal" href="../../agentchat-user-guide/index.html"><span class="std std-doc">AgentChat API</span></a> has a built-in implementation
of selector group chat. You can use that if you do not want to use the Core API.</p>
</div>
<p>We will be using the <a class="reference external" href="https://github.com/Textualize/rich">rich</a> library to display the messages in a nice format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ! pip install rich</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">openai</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">autogen_core</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DefaultTopicId</span><span class="p">,</span>
    <span class="n">FunctionCall</span><span class="p">,</span>
    <span class="n">Image</span><span class="p">,</span>
    <span class="n">MessageContext</span><span class="p">,</span>
    <span class="n">RoutedAgent</span><span class="p">,</span>
    <span class="n">SingleThreadedAgentRuntime</span><span class="p">,</span>
    <span class="n">TopicId</span><span class="p">,</span>
    <span class="n">TypeSubscription</span><span class="p">,</span>
    <span class="n">message_handler</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">autogen_core.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AssistantMessage</span><span class="p">,</span>
    <span class="n">ChatCompletionClient</span><span class="p">,</span>
    <span class="n">LLMMessage</span><span class="p">,</span>
    <span class="n">SystemMessage</span><span class="p">,</span>
    <span class="n">UserMessage</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">autogen_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">FunctionTool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">autogen_ext.models.openai</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>  <span class="c1"># type: ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.markdown</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markdown</span>
</pre></div>
</div>
</div>
</div>
<section id="message-protocol">
<h2>Message Protocol<a class="headerlink" href="#message-protocol" title="Link to this heading">#</a></h2>
<p>The message protocol for the group chat pattern is simple.</p>
<ol class="arabic simple">
<li><p>To start, user or an external agent publishes a <code class="docutils literal notranslate"><span class="pre">GroupChatMessage</span></code> message to the common topic of all participants.</p></li>
<li><p>The group chat manager selects the next speaker, sends out a <code class="docutils literal notranslate"><span class="pre">RequestToSpeak</span></code> message to that agent.</p></li>
<li><p>The agent publishes a <code class="docutils literal notranslate"><span class="pre">GroupChatMessage</span></code> message to the common topic upon receiving the <code class="docutils literal notranslate"><span class="pre">RequestToSpeak</span></code> message.</p></li>
<li><p>This process continues until a termination condition is reached at the group chat manager, which then stops issuing <code class="docutils literal notranslate"><span class="pre">RequestToSpeak</span></code> message, and the group chat ends.</p></li>
</ol>
<p>The following diagram illustrates steps 2 to 4 above.</p>
<p><img alt="Group chat message protocol" src="../../../_images/groupchat.svg" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">GroupChatMessage</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">UserMessage</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RequestToSpeak</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="base-group-chat-agent">
<h2>Base Group Chat Agent<a class="headerlink" href="#base-group-chat-agent" title="Link to this heading">#</a></h2>
<p>Let’s first define the agent class that only uses LLM models to generate text.
This is will be used as the base class for all AI agents in the group chat.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BaseGroupChatAgent</span><span class="p">(</span><span class="n">RoutedAgent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A group chat participant using an LLM.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">group_chat_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_client</span><span class="p">:</span> <span class="n">ChatCompletionClient</span><span class="p">,</span>
        <span class="n">system_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_chat_topic_type</span> <span class="o">=</span> <span class="n">group_chat_topic_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span> <span class="o">=</span> <span class="n">model_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_system_message</span> <span class="o">=</span> <span class="n">SystemMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">system_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LLMMessage</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@message_handler</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">GroupChatMessage</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Transferred to </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="p">),</span>
                <span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="nd">@message_handler</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_request_to_speak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">RequestToSpeak</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># print(f&quot;\n{&#39;-&#39;*80}\n{self.id.type}:&quot;, flush=True)</span>
        <span class="n">Console</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Transferred to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, adopt the persona immediately.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">completion</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span><span class="o">.</span><span class="n">create</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_system_message</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssistantMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
        <span class="n">Console</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
        <span class="c1"># print(completion.content, flush=True)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
            <span class="n">GroupChatMessage</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">)),</span>
            <span class="n">topic_id</span><span class="o">=</span><span class="n">DefaultTopicId</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_group_chat_topic_type</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="writer-and-editor-agents">
<h2>Writer and Editor Agents<a class="headerlink" href="#writer-and-editor-agents" title="Link to this heading">#</a></h2>
<p>Using the base class, we can define the writer and editor agents with
different system messages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">WriterAgent</span><span class="p">(</span><span class="n">BaseGroupChatAgent</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_chat_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_client</span><span class="p">:</span> <span class="n">ChatCompletionClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">group_chat_topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span>
            <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
            <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are a Writer. You produce good work.&quot;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">EditorAgent</span><span class="p">(</span><span class="n">BaseGroupChatAgent</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_chat_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_client</span><span class="p">:</span> <span class="n">ChatCompletionClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">group_chat_topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span>
            <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
            <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are an Editor. Plan and guide the task given by the user. Provide critical feedbacks to the draft and illustration produced by Writer and Illustrator. &quot;</span>
            <span class="s2">&quot;Approve if the task is completed and the draft and illustration meets user&#39;s requirements.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="illustrator-agent-with-image-generation">
<h2>Illustrator Agent with Image Generation<a class="headerlink" href="#illustrator-agent-with-image-generation" title="Link to this heading">#</a></h2>
<p>Now let’s define the <code class="docutils literal notranslate"><span class="pre">IllustratorAgent</span></code> which uses a DALL-E model to generate
an illustration based on the description provided.
We set up the image generator as a tool using <a class="reference internal" href="../../../reference/python/autogen_core.tools.html#autogen_core.tools.FunctionTool" title="autogen_core.tools.FunctionTool"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionTool</span></code></a>
wrapper, and use a model client to make the tool call.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">IllustratorAgent</span><span class="p">(</span><span class="n">BaseGroupChatAgent</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">group_chat_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_client</span><span class="p">:</span> <span class="n">ChatCompletionClient</span><span class="p">,</span>
        <span class="n">image_client</span><span class="p">:</span> <span class="n">openai</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">group_chat_topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span>
            <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
            <span class="n">system_message</span><span class="o">=</span><span class="s2">&quot;You are an Illustrator. You use the generate_image tool to create images given user&#39;s requirement. &quot;</span>
            <span class="s2">&quot;Make sure the images have consistent characters and style.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_client</span> <span class="o">=</span> <span class="n">image_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_image_gen_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_image_gen</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;generate_image&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Call this to generate an image. &quot;</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_image_gen</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">character_appearence</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">style_attributes</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">worn_and_carried</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Digital painting of a </span><span class="si">{</span><span class="n">character_appearence</span><span class="si">}</span><span class="s2"> character with </span><span class="si">{</span><span class="n">style_attributes</span><span class="si">}</span><span class="s2">. Wearing </span><span class="si">{</span><span class="n">worn_and_carried</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_client</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;dall-e-3&quot;</span><span class="p">,</span> <span class="n">response_format</span><span class="o">=</span><span class="s2">&quot;b64_json&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;1024x1024&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">b64_json</span>  <span class="c1"># type: ignore</span>

    <span class="nd">@message_handler</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_request_to_speak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">RequestToSpeak</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="n">Console</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Transferred to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, adopt the persona immediately.&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;system&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Ensure that the image generation tool is used.</span>
        <span class="n">completion</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_system_message</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_gen_tool</span><span class="p">],</span>
            <span class="n">extra_create_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;tool_choice&quot;</span><span class="p">:</span> <span class="s2">&quot;required&quot;</span><span class="p">},</span>
            <span class="n">cancellation_token</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">cancellation_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">completion</span><span class="o">.</span><span class="n">content</span>
        <span class="p">)</span>
        <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Image</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tool_call</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">Console</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_gen_tool</span><span class="o">.</span><span class="n">run_json</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">cancellation_token</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">from_base64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_gen_tool</span><span class="o">.</span><span class="n">return_value_as_string</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">from_pil</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)))</span>
            <span class="n">display</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
            <span class="n">GroupChatMessage</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">images</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">)),</span>
            <span class="n">DefaultTopicId</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_group_chat_topic_type</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="user-agent">
<h2>User Agent<a class="headerlink" href="#user-agent" title="Link to this heading">#</a></h2>
<p>With all the AI agents defined, we can now define the user agent that will
take the role of the human user in the group chat.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">UserAgent</span></code> implementation uses console input to get the user’s input.
In a real-world scenario, you can replace this by communicating with a frontend,
and subscribe to responses from the frontend.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">UserAgent</span><span class="p">(</span><span class="n">RoutedAgent</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_chat_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_chat_topic_type</span> <span class="o">=</span> <span class="n">group_chat_topic_type</span>

    <span class="nd">@message_handler</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">GroupChatMessage</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># When integrating with a frontend, this is where group chat message would be sent to the frontend.</span>
        <span class="k">pass</span>

    <span class="nd">@message_handler</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_request_to_speak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">RequestToSpeak</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter your message, type &#39;APPROVE&#39; to conclude the task: &quot;</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">()</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### User: </span><span class="se">\n</span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
            <span class="n">GroupChatMessage</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">user_input</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">)),</span>
            <span class="n">DefaultTopicId</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_group_chat_topic_type</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="group-chat-manager">
<h2>Group Chat Manager<a class="headerlink" href="#group-chat-manager" title="Link to this heading">#</a></h2>
<p>Lastly, we define the <code class="docutils literal notranslate"><span class="pre">GroupChatManager</span></code> agent which manages the group chat
and selects the next agent to speak using an LLM.
The group chat manager checks if the editor has approved the draft by
looking for the <code class="docutils literal notranslate"><span class="pre">&quot;APPORVED&quot;</span></code> keyword in the message. If the editor has approved
the draft, the group chat manager stops selecting the next speaker, and the group chat ends.</p>
<p>The group chat manager’s constructor takes a list of participants’ topic types
as an argument.
To prompt the next speaker to work,
the <code class="docutils literal notranslate"><span class="pre">GroupChatManager</span></code> agent publishes a <code class="docutils literal notranslate"><span class="pre">RequestToSpeak</span></code> message to the next participant’s topic.</p>
<p>In this example, we also make sure the group chat manager always picks a different
participant to speak next, by keeping track of the previous speaker.
This helps to ensure the group chat is not dominated by a single participant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">GroupChatManager</span><span class="p">(</span><span class="n">RoutedAgent</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">participant_topic_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">model_client</span><span class="p">:</span> <span class="n">ChatCompletionClient</span><span class="p">,</span>
        <span class="n">participant_descriptions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;Group chat manager&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_participant_topic_types</span> <span class="o">=</span> <span class="n">participant_topic_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span> <span class="o">=</span> <span class="n">model_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UserMessage</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_participant_descriptions</span> <span class="o">=</span> <span class="n">participant_descriptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_participant_topic_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@message_handler</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">GroupChatMessage</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">UserMessage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="c1"># If the message is an approval message from the user, stop the chat.</span>
        <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;User&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;approve&quot;</span><span class="p">):</span>
                <span class="k">return</span>
        <span class="c1"># Format message history.</span>
        <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chat_history</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">line</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;[Image]&quot;</span><span class="p">)</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">history</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="c1"># Format roles.</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">topic_type</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_participant_topic_types</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_participant_descriptions</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">topic_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_participant_topic_type</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">selector_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are in a role play game. The following roles are available:</span>
<span class="si">{roles}</span><span class="s2">.</span>
<span class="s2">Read the following conversation. Then select the next role from </span><span class="si">{participants}</span><span class="s2"> to play. Only return the role.</span>

<span class="si">{history}</span>

<span class="s2">Read the above conversation. Then select the next role from </span><span class="si">{participants}</span><span class="s2"> to play. Only return the role.</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">system_message</span> <span class="o">=</span> <span class="n">SystemMessage</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="n">selector_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">roles</span><span class="o">=</span><span class="n">roles</span><span class="p">,</span>
                <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
                <span class="n">participants</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">topic_type</span>
                        <span class="k">for</span> <span class="n">topic_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_participant_topic_types</span>
                        <span class="k">if</span> <span class="n">topic_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_participant_topic_type</span>
                    <span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">completion</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span><span class="o">.</span><span class="n">create</span><span class="p">([</span><span class="n">system_message</span><span class="p">],</span> <span class="n">cancellation_token</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">cancellation_token</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="n">selected_topic_type</span><span class="p">:</span> <span class="nb">str</span>
        <span class="k">for</span> <span class="n">topic_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_participant_topic_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">topic_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">selected_topic_type</span> <span class="o">=</span> <span class="n">topic_type</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_previous_participant_topic_type</span> <span class="o">=</span> <span class="n">selected_topic_type</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span><span class="n">RequestToSpeak</span><span class="p">(),</span> <span class="n">DefaultTopicId</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">selected_topic_type</span><span class="p">))</span>
                <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid role selected: </span><span class="si">{</span><span class="n">completion</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-the-group-chat">
<h2>Creating the Group Chat<a class="headerlink" href="#creating-the-group-chat" title="Link to this heading">#</a></h2>
<p>To set up the group chat, we create a <a class="reference internal" href="../../../reference/python/autogen_core.html#autogen_core.SingleThreadedAgentRuntime" title="autogen_core.SingleThreadedAgentRuntime"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingleThreadedAgentRuntime</span></code></a>
and register the agents’ factories and subscriptions.</p>
<p>Each participant agent subscribes to both the group chat topic as well as its own
topic in order to receive <code class="docutils literal notranslate"><span class="pre">RequestToSpeak</span></code> messages,
while the group chat manager agent only subcribes to the group chat topic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime</span> <span class="o">=</span> <span class="n">SingleThreadedAgentRuntime</span><span class="p">()</span>

<span class="n">editor_topic_type</span> <span class="o">=</span> <span class="s2">&quot;Editor&quot;</span>
<span class="n">writer_topic_type</span> <span class="o">=</span> <span class="s2">&quot;Writer&quot;</span>
<span class="n">illustrator_topic_type</span> <span class="o">=</span> <span class="s2">&quot;Illustrator&quot;</span>
<span class="n">user_topic_type</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>
<span class="n">group_chat_topic_type</span> <span class="o">=</span> <span class="s2">&quot;group_chat&quot;</span>

<span class="n">editor_description</span> <span class="o">=</span> <span class="s2">&quot;Editor for planning and reviewing the content.&quot;</span>
<span class="n">writer_description</span> <span class="o">=</span> <span class="s2">&quot;Writer for creating any text content.&quot;</span>
<span class="n">user_description</span> <span class="o">=</span> <span class="s2">&quot;User for providing final approval.&quot;</span>
<span class="n">illustrator_description</span> <span class="o">=</span> <span class="s2">&quot;An illustrator for creating images.&quot;</span>

<span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-2024-08-06&quot;</span><span class="p">,</span>
    <span class="c1"># api_key=&quot;YOUR_API_KEY&quot;,</span>
<span class="p">)</span>

<span class="n">editor_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">EditorAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="n">runtime</span><span class="p">,</span>
    <span class="n">editor_topic_type</span><span class="p">,</span>  <span class="c1"># Using topic type as the agent type.</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">EditorAgent</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">editor_description</span><span class="p">,</span>
        <span class="n">group_chat_topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">editor_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">editor_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">editor_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

<span class="n">writer_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">WriterAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="n">runtime</span><span class="p">,</span>
    <span class="n">writer_topic_type</span><span class="p">,</span>  <span class="c1"># Using topic type as the agent type.</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">WriterAgent</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">writer_description</span><span class="p">,</span>
        <span class="n">group_chat_topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">writer_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">writer_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">writer_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

<span class="n">illustrator_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">IllustratorAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="n">runtime</span><span class="p">,</span>
    <span class="n">illustrator_topic_type</span><span class="p">,</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">IllustratorAgent</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">illustrator_description</span><span class="p">,</span>
        <span class="n">group_chat_topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
        <span class="n">image_client</span><span class="o">=</span><span class="n">openai</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span>
            <span class="c1"># api_key=&quot;YOUR_API_KEY&quot;,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span>
    <span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">illustrator_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">illustrator_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span>
    <span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">illustrator_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">user_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="n">runtime</span><span class="p">,</span>
    <span class="n">user_topic_type</span><span class="p">,</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">UserAgent</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">user_description</span><span class="p">,</span> <span class="n">group_chat_topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">user_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">user_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

<span class="n">group_chat_manager_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">GroupChatManager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
    <span class="n">runtime</span><span class="p">,</span>
    <span class="s2">&quot;group_chat_manager&quot;</span><span class="p">,</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">GroupChatManager</span><span class="p">(</span>
        <span class="n">participant_topic_types</span><span class="o">=</span><span class="p">[</span><span class="n">writer_topic_type</span><span class="p">,</span> <span class="n">illustrator_topic_type</span><span class="p">,</span> <span class="n">editor_topic_type</span><span class="p">,</span> <span class="n">user_topic_type</span><span class="p">],</span>
        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
        <span class="n">participant_descriptions</span><span class="o">=</span><span class="p">[</span><span class="n">writer_description</span><span class="p">,</span> <span class="n">illustrator_description</span><span class="p">,</span> <span class="n">editor_description</span><span class="p">,</span> <span class="n">user_description</span><span class="p">],</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span>
    <span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">group_chat_manager_type</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-the-group-chat">
<h2>Running the Group Chat<a class="headerlink" href="#running-the-group-chat" title="Link to this heading">#</a></h2>
<p>We start the runtime and publish a <code class="docutils literal notranslate"><span class="pre">GroupChatMessage</span></code> for the task to start the group chat.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">runtime</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
    <span class="n">GroupChatMessage</span><span class="p">(</span>
        <span class="n">body</span><span class="o">=</span><span class="n">UserMessage</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Please write a short story about the gingerbread man with up to 3 photo-realistic illustrations.&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;User&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">),</span>
    <span class="n">TopicId</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">group_chat_topic_type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">session_id</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">stop_when_idle</span><span class="p">()</span>
<span class="k">await</span> <span class="n">model_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                                                      <span style="font-weight: bold">Writer:</span>                                                      
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Title: The Escape of the Gingerbread Man</span>                                                                           

<span style="font-weight: bold">Illustration 1: A Rustic Kitchen Scene</span> In a quaint little cottage at the edge of an enchanted forest, an elderly   
woman, with flour-dusted hands, carefully shapes gingerbread dough on a wooden counter. The aroma of ginger,       
cinnamon, and cloves wafts through the air as a warm breeze from the open window dances with fluttering curtains.  
The sunlight gently permeates the cozy kitchen, casting a golden hue over the flour-dusted surfaces and the rolling
pin. Heartfelt trinkets and rustic decorations adorn the shelves - signs of a lived-in, lovingly nurtured home.    

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span style="font-weight: bold">Story:</span>                                                                                                             

Once there was an old woman who lived alone in a charming cottage, her days filled with the joyful art of baking.  
One sunny afternoon, she decided to make a special gingerbread man to keep her company. As she shaped him tenderly 
and placed him in the oven, she couldn't help but smile at the delight he might bring.                             

But to her astonishment, once she opened the oven door to check on her creation, the gingerbread man leapt out,    
suddenly alive. His eyes were bright as beads, and his smile cheeky and wide. "Run, run, as fast as you can! You   
can't catch me, I'm the Gingerbread Man!" he laughed, darting towards the door.                                    

The old woman, chuckling at the unexpected mischief, gave chase, but her footsteps were slow with the weight of    
age. The Gingerbread Man raced out of the door and into the sunny afternoon.                                       

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span style="font-weight: bold">Illustration 2: A Frolic Through the Meadow</span> The Gingerbread Man darts through a vibrant meadow, his arms swinging  
joyously by his sides. Behind him trails the old woman, her apron flapping in the wind as she gently tries to catch
up. Wildflowers of every color bloom vividly under the radiant sky, painting the scene with shades of nature's     
brilliance. Birds flit through the sky and a stream babbles nearby, oblivious to the chase taking place below.     

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
Continuing his sprint, the Gingerbread Man encountered a cow grazing peacefully. Intrigued, the cow trotted        
forward. "Stop, Gingerbread Man! I wish to eat you!" she called, but the Gingerbread Man only twirled in a teasing 
jig, flashing his icing smile before darting off again.                                                            

"Run, run, as fast as you can! You can't catch me, I'm the Gingerbread Man!" he taunted, leaving the cow in his    
spicy wake.                                                                                                        

As he zoomed across the meadow, he spied a cautious horse in a nearby paddock, who neighed, "Oh! You look          
delicious! I want to eat you!" But the Gingerbread Man only laughed, his feet barely touching the earth. The horse 
joined the trail, hooves pounding, but even he couldn't match the Gingerbread Man's pace.                          

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span style="font-weight: bold">Illustration 3: A Bridge Over a Sparkling River</span> Arriving at a wooden bridge across a shimmering river, the         
Gingerbread Man pauses momentarily, his silhouette against the glistening water. Sunlight sparkles off the water's 
soft ripples casting reflections that dance like small constellations. A sly fox emerges from the shadows of a     
blooming willow on the riverbank, his eyes alight with cunning and curiosity.                                      

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
The Gingerbread Man bounded onto the bridge and skirted past a sly, watching fox. "Foolish Gingerbread Man," the   
fox mused aloud, "you might have outrun them all, but you can't possibly swim across that river."                  

Pausing, the Gingerbread Man considered this dilemma. But the fox, oh so clever, offered a dangerous solution.     
"Climb on my back, and I'll carry you across safely," he suggested with a sly smile.                               

Gingerbread thought himself smarter than that but hesitated, fearing the water or being pursued by the tired,      
hungry crowd now gathering. "Promise you won't eat me?" he ventured.                                               

"Of course," the fox reassured, a gleam in his eyes that the others pondered from a distance.                      

As they crossed the river, the gingerbread man confident on his ride, the old woman, cow, and horse hoped for his  
safety. Yet, nearing the middle, the crafty fox tilted his chin and swiftly snapped, swallowing the gingerbread man
whole.                                                                                                             

Bewildered but awed by the clever twist they had witnessed, the old woman hung her head while the cow and horse    
ambled away, pondering the fate of the boisterous Gingerbread Man.                                                 

The fox, licking his lips, ambled along the river, savoring his victory, leaving an air of mystery hovering above  
the shimmering waters, where the memory of the Gingerbread Man's spirited run lingered long after.                 
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                                                       <span style="font-weight: bold">User:</span>                                                       
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                                                      <span style="font-weight: bold">Editor:</span>                                                      
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Thank you for submitting the draft and illustrations for the short story, "The Escape of the Gingerbread Man."     
Let's go through the story and illustrations critically:                                                           

                                                  <span style="font-weight: bold">Story Feedback:</span>                                                  

<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 1 </span><span style="font-weight: bold">Plot &amp; Structure:</span>                                                                                               
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The story follows the traditional gingerbread man tale closely, which might appeal to readers looking for a  
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>classic retelling. Consider adding a unique twist or additional layer to make it stand out.                  
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 2 </span><span style="font-weight: bold">Character Development:</span>                                                                                          
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The gingerbread man is depicted with a cheeky personality, which is consistent throughout. However, for the  
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>old woman, cow, horse, and fox, incorporating a bit more personality might enrich the narrative.             
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 3 </span><span style="font-weight: bold">Pacing:</span>                                                                                                         
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The story moves at a brisk pace, fitting for the short story format. Ensure that each scene provides enough  
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>space to breathe, especially during the climactic encounter with the fox.                                    
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 4 </span><span style="font-weight: bold">Tone &amp; Language:</span>                                                                                                
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The tone is playful and suitable for a fairy-tale audience. The language is accessible, though some richer   
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>descriptive elements could enhance the overall atmosphere.                                                   
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 5 </span><span style="font-weight: bold">Moral/Lesson:</span>                                                                                                   
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The ending carries the traditional moral of caution against naivety. Consider if there are other themes you  
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>wish to explore or highlight within the story.                                                               

                                              <span style="font-weight: bold">Illustration Feedback:</span>                                               

<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 1 </span><span style="font-weight: bold">Illustration 1: A Rustic Kitchen Scene</span>                                                                          
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The visual captures the essence of a cozy, magical kitchen well. Adding small whimsical elements that hint at
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>the gingerbread man’s impending animation might spark more curiosity.                                        
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 2 </span><span style="font-weight: bold">Illustration 2: A Frolic Through the Meadow</span>                                                                     
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The vibrant colors and dynamic composition effectively convey the chase scene. Make sure the sense of speed  
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>and energy of the Gingerbread Man is accentuated, possibly with more expressive motion lines or postures.    
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold"> 3 </span><span style="font-weight: bold">Illustration 3: A Bridge Over a Sparkling River</span>                                                                 
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">    • </span>The river and reflection are beautifully rendered. The fox, however, could benefit from a more cunning       
<span style="color: #808000; text-decoration-color: #808000; font-weight: bold">      </span>appearance, with sharper features that emphasize its sly nature.                                             

                                                    <span style="font-weight: bold">Conclusion:</span>                                                    

Overall, the draft is well-structured, and the illustrations complement the story effectively. With slight         
enhancements in the narrative's depth and character detail, along with minor adjustments to the illustrations, the 
project will meet the user's requirements admirably.                                                               

Please make the suggested revisions, and once those are implemented, the story should be ready for approval. Let me
know if you have any questions or need further guidance!                                                           
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                                                   <span style="font-weight: bold">Illustrator:</span>                                                    
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'character_appearence'</span>: <span style="color: #008000; text-decoration-color: #008000">'An elderly woman with flour-dusted hands shaping gingerbread dough. Sunlight casts a </span>
<span style="color: #008000; text-decoration-color: #008000">golden hue in the cozy kitchen, with rustic decorations and trinkets on shelves.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'style_attributes'</span>: <span style="color: #008000; text-decoration-color: #008000">'Photo-realistic with warm and golden hues.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'worn_and_carried'</span>: <span style="color: #008000; text-decoration-color: #008000">'The woman wears a flour-covered apron and a gentle smile.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'scenario'</span>: <span style="color: #008000; text-decoration-color: #008000">'An old woman baking gingerbread in a warm, rustic cottage kitchen.'</span>
<span style="font-weight: bold">}</span>
</pre>
</div><img alt="../../../_images/44233632b6aae6dcc27b84f8a8c4ee6d99a46bdb26fb92135954f5599a27606e.png" src="../../../_images/44233632b6aae6dcc27b84f8a8c4ee6d99a46bdb26fb92135954f5599a27606e.png" />
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'character_appearence'</span>: <span style="color: #008000; text-decoration-color: #008000">'A gingerbread man with bright bead-like eyes and a wide smile, running joyfully.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'style_attributes'</span>: <span style="color: #008000; text-decoration-color: #008000">'Photo-realistic with vibrant and lively colors.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'worn_and_carried'</span>: <span style="color: #008000; text-decoration-color: #008000">'The gingerbread man has white icing features and a cheeky appearance.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'scenario'</span>: <span style="color: #008000; text-decoration-color: #008000">'The gingerbread man running through a colorful meadow, followed by an old woman, cow, and horse.'</span>
<span style="font-weight: bold">}</span>
</pre>
</div><img alt="../../../_images/6712bbca303e1defbca5cbcf1a63dfcbc84a747ea3f65913e3b9cdc1e8dd1d38.png" src="../../../_images/6712bbca303e1defbca5cbcf1a63dfcbc84a747ea3f65913e3b9cdc1e8dd1d38.png" />
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'character_appearence'</span>: <span style="color: #008000; text-decoration-color: #008000">'A sly fox with cunning eyes, engaging with the gingerbread man.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'style_attributes'</span>: <span style="color: #008000; text-decoration-color: #008000">'Photo-realistic with a focus on sly and clever features.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'worn_and_carried'</span>: <span style="color: #008000; text-decoration-color: #008000">'The fox has sharp features and a lolled tail.'</span>,
    <span style="color: #008000; text-decoration-color: #008000">'scenario'</span>: <span style="color: #008000; text-decoration-color: #008000">'The gingerbread man on a wooden bridge, facing a sly fox by a sparkling river under sunlight.'</span>
<span style="font-weight: bold">}</span>
</pre>
</div><img alt="../../../_images/5613e43a3461bcbe4b9ac91fd240aeefabcbbf97cc1cb54127bc19a1736b082f.png" src="../../../_images/5613e43a3461bcbe4b9ac91fd240aeefabcbbf97cc1cb54127bc19a1736b082f.png" />
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                                                      <span style="font-weight: bold">Writer:</span>                                                      
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Certainly! Here’s the final version of the short story with the enhanced illustrations for "The Escape of the      
Gingerbread Man."                                                                                                  

<span style="font-weight: bold">Title: The Escape of the Gingerbread Man</span>                                                                           

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span style="font-weight: bold">Illustration 1: A Rustic Kitchen Scene</span> In a quaint little cottage at the edge of an enchanted forest, an elderly   
woman, with flour-dusted hands, carefully shapes gingerbread dough on a wooden counter. The aroma of ginger,       
cinnamon, and cloves wafts through the air as a warm breeze from the open window dances with fluttering curtains.  
The sunlight gently permeates the cozy kitchen, casting a golden hue over the flour-dusted surfaces and the rolling
pin. Heartfelt trinkets and rustic decorations adorn the shelves—a sign of a lived-in, lovingly nurtured home.     

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span style="font-weight: bold">Story:</span>                                                                                                             

Once there was an old woman who lived alone in a charming cottage, her days filled with the joyful art of baking.  
One sunny afternoon, she decided to make a special gingerbread man to keep her company. As she shaped him tenderly 
and placed him in the oven, she couldn't help but smile at the delight he might bring.                             

But to her astonishment, once she opened the oven door to check on her creation, the gingerbread man leapt out,    
suddenly alive. His eyes were bright as beads, and his smile cheeky and wide. "Run, run, as fast as you can! You   
can't catch me, I'm the Gingerbread Man!" he laughed, darting towards the door.                                    

The old woman, chuckling at the unexpected mischief, gave chase, but her footsteps were slow with the weight of    
age. The Gingerbread Man raced out of the door and into the sunny afternoon.                                       

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span style="font-weight: bold">Illustration 2: A Frolic Through the Meadow</span> The Gingerbread Man darts through a vibrant meadow, his arms swinging  
joyously by his sides. Behind him trails the old woman, her apron flapping in the wind as she gently tries to catch
up. Wildflowers of every color bloom vividly under the radiant sky, painting the scene with shades of nature's     
brilliance. Birds flit through the sky and a stream babbles nearby, oblivious to the chase taking place below.     

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
Continuing his sprint, the Gingerbread Man encountered a cow grazing peacefully. Intrigued, the cow trotted        
forward. "Stop, Gingerbread Man! I wish to eat you!" she called, but the Gingerbread Man only twirled in a teasing 
jig, flashing his icing smile before darting off again.                                                            

"Run, run, as fast as you can! You can't catch me, I'm the Gingerbread Man!" he taunted, leaving the cow in his    
spicy wake.                                                                                                        

As he zoomed across the meadow, he spied a cautious horse in a nearby paddock, who neighed, "Oh! You look          
delicious! I want to eat you!" But the Gingerbread Man only laughed, his feet barely touching the earth. The horse 
joined the trail, hooves pounding, but even he couldn't match the Gingerbread Man's pace.                          

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
<span style="font-weight: bold">Illustration 3: A Bridge Over a Sparkling River</span> Arriving at a wooden bridge across a shimmering river, the         
Gingerbread Man pauses momentarily, his silhouette against the glistening water. Sunlight sparkles off the water's 
soft ripples casting reflections that dance like small constellations. A sly fox emerges from the shadows of a     
blooming willow on the riverbank, his eyes alight with cunning and curiosity.                                      

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
The Gingerbread Man bounded onto the bridge and skirted past a sly, watching fox. "Foolish Gingerbread Man," the   
fox mused aloud, "you might have outrun them all, but you can't possibly swim across that river."                  

Pausing, the Gingerbread Man considered this dilemma. But the fox, oh so clever, offered a dangerous solution.     
"Climb on my back, and I'll carry you across safely," he suggested with a sly smile.                               

Gingerbread thought himself smarter than that but hesitated, fearing the water or being pursued by the tired,      
hungry crowd now gathering. "Promise you won't eat me?" he ventured.                                               

"Of course," the fox reassured, a gleam in his eyes that the others pondered from a distance.                      

As they crossed the river, the gingerbread man confident on his ride, the old woman, cow, and horse hoped for his  
safety. Yet, nearing the middle, the crafty fox tilted his chin and swiftly snapped, swallowing the gingerbread man
whole.                                                                                                             

Bewildered but awed by the clever twist they had witnessed, the old woman hung her head while the cow and horse    
ambled away, pondering the fate of the boisterous Gingerbread Man.                                                 

The fox, licking his lips, ambled along the river, savoring his victory, leaving an air of mystery hovering above  
the shimmering waters, where the memory of the Gingerbread Man's spirited run lingered long after.                 

<span style="color: #808000; text-decoration-color: #808000">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
I hope you enjoy the enhanced version of the tale!                                                                 
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">                                                       <span style="font-weight: bold">User:</span>                                                       

approve                                                                                                            
</pre>
</div></div>
</div>
<p>From the output, you can see the writer, illustrator, and editor agents
taking turns to speak and collaborate to generate a picture book, before
asking for final approval from the user.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>This example showcases a simple implementation of the group chat pattern –
<strong>it is not meant to be used in real applications.</strong> You can improve the
speaker selection algorithm. For example, you can avoid using LLM when simple
rules are sufficient and more reliable:
you can use a rule that the editor always speaks after the writer.</p>
<p>The <a class="reference internal" href="../../agentchat-user-guide/index.html"><span class="std std-doc">AgentChat API</span></a> provides a high-level
API for selector group chat. It has more features but mostly shares the same
design as this implementation.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="sequential-workflow.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Sequential Workflow</p>
      </div>
    </a>
    <a class="right-next"
       href="handoffs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Handoffs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#message-protocol">Message Protocol</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#base-group-chat-agent">Base Group Chat Agent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#writer-and-editor-agents">Writer and Editor Agents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#illustrator-agent-with-image-generation">Illustrator Agent with Image Generation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#user-agent">User Agent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#group-chat-manager">Group Chat Manager</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-the-group-chat">Creating the Group Chat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-group-chat">Running the Group Chat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  
  <div class="tocsection editthispage">
    <a href="https://github.com/microsoft/autogen/edit/main/python/docs/src/user-guide/core-user-guide/design-patterns/group-chat.ipynb">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/user-guide/core-user-guide/design-patterns/group-chat.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Microsoft.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item"><p><a href="https://go.microsoft.com/fwlink/?LinkId=521839">Privacy Policy</a> | <a href="https://go.microsoft.com/fwlink/?linkid=2259814">Consumer Health Privacy</a> </p></div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
        <div class="footer-item"><script src="_static/banner-override.js"></script></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>